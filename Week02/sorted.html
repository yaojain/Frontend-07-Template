<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    .call {
      background: #666;
      width: 5px;
      height: 5px;
      border-right: 1px solid #fff;
      border-bottom: 1px solid #33d;
      display: inline-block;
    }

    .map {
      display: flex;
      justify-content: flex-start;
      flex-wrap: wrap;
      width: 600px;
    }
  </style>
</head>

<body>
  <div class="map"></div>
  <button onclick="localStorage['map'] =JSON.stringify(mapList) ">save</button>
  <script>
    class Sorted {
      constructor(data, compare) {
        this.data = data.slice();
        this.compare = compare || ((a, b) => a - b)
      }
      take() {
        if (!this.data.length) {
          return
        }
        let min = this.data[0]
        let minIndex = 0
        for (let i = 1; i < this.data.length; i++) {
          if (this.compare(this.data[i], min) < 0) {
            minIndex = i
            min = this.data[i]
          }
        }
        this.data[minIndex] = this.data[this.data.length - 1]
        this.data.pop()
        return min
      }
      give(v) {
        this.data.push(v)
      }
    }
    let map = document.getElementsByClassName('map')[0];
    let mapList = localStorage['map'] ? JSON.parse(localStorage['map']) : JSON.parse({"787":1,"788":1,"806":1,"885":1,"886":1,"887":1,"907":1,"983":1,"984":1,"985":1,"986":1,"987":1,"1016":1,"1017":1,"1082":1,"1083":1,"1084":1,"1116":1,"1117":1,"1118":1,"1180":1,"1181":1,"1182":1,"1183":1,"1215":1,"1216":1,"1217":1,"1218":1,"1219":1,"1277":1,"1278":1,"1279":1,"1280":1,"1281":1,"1282":1,"1314":1,"1315":1,"1316":1,"1317":1,"1318":1,"1319":1,"1320":1,"1321":1,"1375":1,"1376":1,"1377":1,"1378":1,"1379":1,"1380":1,"1413":1,"1414":1,"1415":1,"1416":1,"1417":1,"1418":1,"1419":1,"1420":1,"1421":1,"1422":1,"1423":1,"1441":1,"1442":1,"1443":1,"1444":1,"1445":1,"1446":1,"1447":1,"1448":1,"1449":1,"1450":1,"1451":1,"1452":1,"1453":1,"1454":1,"1455":1,"1456":1,"1457":1,"1458":1,"1474":1,"1475":1,"1476":1,"1477":1,"1478":1,"1513":1,"1514":1,"1515":1,"1519":1,"1520":1,"1521":1,"1522":1,"1523":1,"1524":1,"1535":1,"1536":1,"1537":1,"1538":1,"1539":1,"1540":1,"1541":1,"1542":1,"1543":1,"1544":1,"1545":1,"1546":1,"1547":1,"1548":1,"1549":1,"1550":1,"1551":1,"1552":1,"1553":1,"1554":1,"1555":1,"1556":1,"1557":1,"1558":1,"1559":1,"1572":1,"1573":1,"1574":1,"1575":1,"1576":1,"1613":1,"1614":1,"1615":1,"1620":1,"1621":1,"1622":1,"1623":1,"1624":1,"1625":1,"1633":1,"1634":1,"1635":1,"1636":1,"1638":1,"1639":1,"1640":1,"1641":1,"1642":1,"1643":1,"1644":1,"1671":1,"1672":1,"1673":1,"1674":1,"1675":1,"1676":1,"1713":1,"1714":1,"1722":1,"1723":1,"1724":1,"1725":1,"1726":1,"1727":1,"1733":1,"1734":1,"1735":1,"1736":1,"1737":1,"1738":1,"1739":1,"1770":1,"1771":1,"1772":1,"1773":1,"1774":1,"1812":1,"1813":1,"1814":1,"1823":1,"1824":1,"1825":1,"1826":1,"1827":1,"1832":1,"1833":1,"1834":1,"1868":1,"1869":1,"1870":1,"1871":1,"1911":1,"1912":1,"1913":1,"1914":1,"1924":1,"1925":1,"1926":1,"1931":1,"1932":1,"1967":1,"1968":1,"1969":1,"1970":1,"2011":1,"2012":1,"2013":1,"2014":1,"2029":1,"2030":1,"2031":1,"2065":1,"2066":1,"2067":1,"2068":1,"2111":1,"2112":1,"2113":1,"2114":1,"2129":1,"2130":1,"2163":1,"2164":1,"2165":1,"2166":1,"2167":1,"2212":1,"2213":1,"2228":1,"2229":1,"2262":1,"2263":1,"2264":1,"2265":1,"2266":1,"2311":1,"2312":1,"2313":1,"2328":1,"2329":1,"2359":1,"2360":1,"2361":1,"2362":1,"2363":1,"2411":1,"2412":1,"2427":1,"2428":1,"2429":1,"2457":1,"2458":1,"2459":1,"2460":1,"2461":1,"2511":1,"2512":1,"2527":1,"2528":1,"2529":1,"2555":1,"2556":1,"2557":1,"2558":1,"2559":1,"2611":1,"2612":1,"2626":1,"2627":1,"2628":1,"2653":1,"2654":1,"2655":1,"2656":1,"2657":1,"2711":1,"2726":1,"2727":1,"2728":1,"2752":1,"2753":1,"2754":1,"2755":1,"2756":1,"2811":1,"2812":1,"2825":1,"2826":1,"2827":1,"2828":1,"2850":1,"2851":1,"2852":1,"2853":1,"2854":1,"2911":1,"2912":1,"2925":1,"2926":1,"2927":1,"2949":1,"2950":1,"2951":1,"2952":1,"3010":1,"3011":1,"3012":1,"3013":1,"3025":1,"3026":1,"3027":1,"3048":1,"3049":1,"3050":1,"3051":1,"3110":1,"3111":1,"3112":1,"3113":1,"3124":1,"3125":1,"3126":1,"3127":1,"3148":1,"3149":1,"3150":1,"3210":1,"3211":1,"3212":1,"3213":1,"3223":1,"3224":1,"3225":1,"3227":1,"3247":1,"3248":1,"3312":1,"3313":1,"3323":1,"3324":1,"3325":1,"3326":1,"3345":1,"3346":1,"3347":1,"3411":1,"3412":1,"3413":1,"3423":1,"3424":1,"3426":1,"3444":1,"3445":1,"3446":1,"3511":1,"3512":1,"3513":1,"3523":1,"3524":1,"3526":1,"3543":1,"3544":1,"3545":1,"3612":1,"3613":1,"3622":1,"3623":1,"3625":1,"3642":1,"3643":1,"3644":1,"3712":1,"3713":1,"3714":1,"3722":1,"3723":1,"3724":1,"3725":1,"3740":1,"3741":1,"3743":1,"3822":1,"3823":1,"3824":1,"3840":1,"3841":1,"3842":1,"3843":1,"3921":1,"3922":1,"3923":1,"3924":1,"3939":1,"3940":1,"3941":1,"3942":1,"4022":1,"4023":1,"4039":1,"4040":1,"4041":1,"4042":1,"4122":1,"4123":1,"4139":1,"4140":1,"4141":1,"4222":1,"4223":1,"4239":1,"4240":1,"4241":1,"4321":1,"4322":1,"4339":1,"4340":1,"4341":1,"4421":1,"4422":1,"4439":1,"4440":1,"4441":1,"4521":1,"4522":1,"4539":1,"4540":1,"4541":1,"4621":1,"4622":1,"4640":1,"4641":1,"4721":1,"4722":1,"4739":1,"4740":1,"4741":1,"4742":1,"4821":1,"4822":1,"4840":1,"4841":1,"4842":1,"4843":1,"4921":1,"4922":1,"4940":1,"4941":1,"4942":1,"4943":1,"5021":1,"5022":1,"5041":1,"5042":1,"5043":1,"5044":1,"5121":1,"5122":1,"5141":1,"5142":1,"5143":1,"5144":1,"5145":1,"5221":1,"5222":1,"5242":1,"5244":1,"5245":1,"5246":1,"5321":1,"5322":1,"5323":1,"5343":1,"5344":1,"5345":1,"5346":1,"5347":1,"5422":1,"5423":1,"5444":1,"5445":1,"5446":1,"5447":1,"5448":1,"5522":1,"5523":1,"5524":1,"5546":1,"5547":1,"5548":1,"5549":1,"5622":1,"5623":1,"5624":1,"5647":1,"5648":1,"5649":1,"5650":1,"5651":1,"5652":1,"5723":1,"5724":1,"5725":1,"5750":1,"5751":1,"5752":1,"5753":1,"5754":1,"5823":1,"5824":1,"5825":1,"5851":1,"5852":1,"5853":1,"5854":1,"5855":1,"5856":1,"5923":1,"5924":1,"5925":1,"5953":1,"5954":1,"5955":1,"5956":1,"5957":1,"5958":1,"5959":1,"5960":1,"6024":1,"6025":1,"6056":1,"6057":1,"6058":1,"6059":1,"6060":1,"6061":1,"6062":1,"6063":1,"6064":1,"6065":1,"6066":1,"6124":1,"6125":1,"6158":1,"6159":1,"6160":1,"6161":1,"6162":1,"6163":1,"6164":1,"6165":1,"6166":1,"6167":1,"6223":1,"6224":1,"6225":1,"6262":1,"6263":1,"6264":1,"6265":1,"6266":1,"6267":1,"6268":1,"6324":1,"6325":1,"6326":1,"6366":1,"6367":1,"6368":1,"6369":1,"6370":1,"6371":1,"6424":1,"6425":1,"6426":1,"6468":1,"6469":1,"6470":1,"6471":1,"6472":1,"6473":1,"6525":1,"6526":1,"6527":1,"6528":1,"6570":1,"6571":1,"6572":1,"6573":1,"6574":1,"6575":1,"6576":1,"6625":1,"6626":1,"6627":1,"6628":1,"6629":1,"6672":1,"6673":1,"6674":1,"6675":1,"6676":1,"6677":1,"6678":1,"6727":1,"6728":1,"6729":1,"6730":1,"6731":1,"6773":1,"6774":1,"6775":1,"6776":1,"6777":1,"6778":1,"6779":1,"6780":1,"6829":1,"6830":1,"6831":1,"6832":1,"6833":1,"6874":1,"6875":1,"6876":1,"6877":1,"6878":1,"6879":1,"6880":1,"6881":1,"6882":1,"6930":1,"6931":1,"6933":1,"6975":1,"6976":1,"6977":1,"6978":1,"6979":1,"6980":1,"6981":1,"6982":1,"6983":1,"7031":1,"7032":1,"7033":1,"7034":1,"7083":1,"7132":1,"7133":1,"7134":1,"7135":1,"7136":1,"7137":1,"7233":1,"7234":1,"7235":1,"7236":1,"7237":1,"7238":1,"7239":1,"7240":1,"7241":1,"7333":1,"7334":1,"7337":1,"7338":1,"7339":1,"7340":1,"7341":1,"7342":1,"7343":1,"7344":1,"7345":1,"7433":1,"7434":1,"7440":1,"7441":1,"7442":1,"7443":1,"7444":1,"7445":1,"7446":1,"7447":1,"7448":1,"7449":1,"7534":1,"7535":1,"7536":1,"7542":1,"7543":1,"7544":1,"7545":1,"7546":1,"7547":1,"7548":1,"7549":1,"7550":1,"7551":1,"7552":1,"7553":1,"7554":1,"7555":1,"7556":1,"7557":1,"7558":1,"7559":1,"7635":1,"7636":1,"7637":1,"7638":1,"7639":1,"7641":1,"7643":1,"7646":1,"7650":1,"7652":1,"7653":1,"7655":1,"7656":1,"7657":1,"7658":1,"7659":1,"7735":1,"7736":1,"7737":1,"7738":1,"7739":1,"7740":1,"7741":1,"7742":1,"7757":1,"7758":1,"7759":1,"7835":1,"7836":1,"7837":1,"7838":1,"7839":1,"7840":1,"7841":1,"7842":1,"7843":1,"7844":1,"7845":1,"7846":1,"7847":1,"7848":1,"7849":1,"7850":1,"7851":1,"7852":1,"7853":1,"7854":1,"7855":1,"7856":1,"7857":1,"7858":1,"7859":1,"7936":1,"7937":1,"7938":1}) //Array(10000).fill(0)

    for (let y = 0; y < 100; y++) {
      for (let x = 0; x < 100; x++) {
        let call = document.createElement('div');
        call.classList.add('call')
        if (mapList[100 * y + x] == 1)
          call.style.backgroundColor = 'red'
        call.addEventListener('mousemove', function (e) {
          if (mousedown) {
            if (clear) {
              call.style.backgroundColor = 'red'
              mapList[100 * y + x] = 1
            } else {
              call.style.backgroundColor = 'red'
              mapList[100 * y + x] = 1
            }
          }
        })
        map.appendChild(call)
      }

    }
    let mousedown = false
    let clear = false
    document.addEventListener("mousedown", (e) => {
      mousedown = true
      clear = (e.which === 3)
    })
    document.addEventListener("mouseup", () => {
      mousedown = false
    })
    document.addEventListener("contextmenu", (e) => {
      return e.preventDefault()
    })
    sleep = (t) => {
      return new Promise((resolve,reject) => {
        setTimeout(resolve, t)
      })
    }
    findPath = async (mapList, start, end) => {
      let queue = new Sorted([start], (a, b) => distance(a) - distance(b))
      console.log(queue)
      let table = Object.create(mapList)

      async function insert(x, y, prev) {
        if (x < 0 || x >= 100 || y < 0 || y >= 100) return  //边界不通
        if (table[y * 100 + x]) return    //墙壁不通
        await sleep(10)
        map.children[y * 100 + x].style.backgroundColor = 'yellow'
        table[y * 100 + x] = prev
        queue.give([x, y])
      }
      function distance(point) {
        return (point[0] - end[0]) ** 2 + (point[1] - end[1]) ** 2
      }
      while (queue.data.length) {
        let [x, y] = queue.take()
        if (x === end[0] && y === end[1]) {
          let path = []
          while (x != start[0] || y != start[1]) {
            [x, y] = table[y * 100 + x]
            path.push(mapList[y * 100 + x])
            await sleep(30)
            map.children[y * 100 + x].style.backgroundColor = 'green'
          }
          return path
        }
        await insert(x - 1, y, [x, y])
        await insert(x, y - 1, [x, y])
        await insert(x + 1, y, [x, y])
        await insert(x, y + 1, [x, y])

        await insert(x - 1, y - 1, [x, y])
        await insert(x + 1, y - 1, [x, y])
        await insert(x - 1, y + 1, [x, y])
        await insert(x + 1, y + 1, [x, y])
      }
      return null
    }
    findPath(mapList, [0, 0], [50, 36])
  </script>
</body>

</html>